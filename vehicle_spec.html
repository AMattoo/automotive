<!DOCTYPE html>
<html>
  <head>
    <title>Vehicle Information API</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            class='remove'></script>
    <script class="remove">
      var respecConfig = {
          specStatus:           "BG-DRAFT",
          shortName:            "vehicle-information-api",
          publishDate:          "",
          previousPublishDate:  "",
          previousMaturity:     "",
          edDraftURI:           "",
          // lcEnd:                "",
          crEnd:                "",
          editors:  [
              { name: "Kevron Rees", company: "Intel",
                      companyURL: "http://www.intel.com" },
              { name: "Justin (Jong Seon) Park", company: "LG Electronics",
                      companyURL: "http://www.lg.com"}
         ],
          inlineCSS:    true,
          noIDLIn:      true,
          wg:           "Automotive and Web Platform Business Group",
          wgURI:        "http://www.w3.org/community/autowebplatform/",
          wgPublicList: "public-autowebplatform",
          wgPatentURI:  "",

          localBiblio:  {
					    "VIN": {
					        title:    "Vehicle Identificaiton Number"
					    ,   href:     "http://en.wikipedia.org/wiki/Vehicle_Identification_Number#World_Manufacturer_Identifier"
					    ,   publisher:  "Wikipedia"
					    }
					}
      };
    </script> 
  </head>

  <body>


<!------------------------------ Abstract ------------------------------------>    
<section id="abstract">
  <p>
  This specification defines a standard for Vehicle Information API used to develop HTML5/JavaScript applications to run on in-vehicle infotainment systems and access resources of the vehicle.  The API can also be used by HTML5/JavaScript applications running on mobile devices to access the resources of a connected vehicle. This specification does not dictate or describe the protocol or transport used for the connection.  Data may come from numerous sources including OBD-II, CAN, LIN, etc. A typical use case of Vehicle Information might be the implementation of a 'virtual mechanic' application that provides vehicle status information such as tire pressure, engine oil level, washer fluid level, battery status, etc. </p>
  <p>
  The specification promotes an API that allows for third party application development in a manner that is consistent across automakers. It is recognized, however, that the mechanisms required for access or control of vehicle properties may differ between automotive trim levels, models, and automakers. Furthermore, different automakers may expose different properties that can be read or set by an application. As a result, this specification shall allow for automaker-specific extensions or restrictions. Extensions are only permitted for interfaces that are not already described by this API, and must be implemented to conform with the existing API format and guidelines used in this specification. If a property is restricted, the automaker would omit the optional feature in their implementation (see the <a>Availability</a> Section). </p>
  <p>
  The target platform supported by the specification is exclusively passenger vehicles. Use of this specification for non-passenger applications (transportation, heavy machinery, marine, airline infotainment, military, etc.)is not prohibited, but is not covered in the design or content of the API and therefore may be insufficient.</p>
  
</section>

<!----------------------- Status of this document ---------------------------->    
<section id="sotd">
</section>
    
<!----------------------------- Introduction --------------------------------->
<section class="informative">
  <h2>Introduction</h2>
  <p>
    The Vehicle Information API provides operations to get access to the vehicle data
    (henceforth "properties") available from vehicle systems and also to change (write) a number of
    properties.  The types of Vehicle data are available in the <a href="data_spec.html">Vehicle Data specification</a>.
  <p>
    An example of use is provided below:
  
  <pre class="example highlight">
        var vehicle = navigator.vehicle;
        
        vehicle.vehicleSpeed.get().then(function(vehicleSpeed) {
          console.log("vehicle speed: " + vehicleSpeed.speed);
        },
        function(error) {
          console.log("There was an error");
        });
        
        var vehicleSpeedSub = vehicle.vehicleSpeed.subscribe(function(vehicleSpeed) {
          console.log("vehicle speed changed to: " + vehicleSpeed.speed);
          vehicle.vehicleSpeed.unsubscribe(vehicleSpeedSub);
        });
        
        var zone = new Zone;
        
        var zones = vehicle.climateControl.zones;
        
        for(var i in zones)
        {
           if(i.equals(zone.driver))
           {
              var value = {};
              value["acStatus"] = true;
              vehicle.climateControl.set(value, zone.driver).then(function(){
                console.log("successfully set acStatus");
             },
             function(error) {
               console.log("there was an error");
             });
           }        
        }        
  </pre>
</section>
    
<!---------------------------- Conformance ----------------------------------->
<section id="conformance">
  <p>This specification defines conformance criteria that apply to a single
  product: the <dfn>user agent</dfn> that implements the interfaces that it
  contains.
  
  <p>Implementations that use ECMAScript to implement the APIs defined in this
  specification MUST implement them in a manner consistent with the ECMAScript
  Bindings defined in the Web IDL specification [[!WEBIDL]], as this
  specification uses that specification and terminology.
</section>
    
<!----------------------------- Terminology ---------------------------------->
<section id="terminology">
<p class="note">Possibly remove some of these and add terms we do use</p>
  <h2>Terminology</h2> <p>The <code><a
  href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
  EventHandler</a></code> interface represents a callback used for event
  handlers as defined in [[!HTML5]].
  
  <p>The concepts <dfn><a
  href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task"> queue a
  task</a></dfn> and <dfn><a
  href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
  fire a simple event</a></dfn> are defined in [[!HTML5]].
  
  <p>The terms <a
  href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers"><dfn
  id="dfn-eventhandler">event handler</dfn></a> and <a
  href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
  <dfn id="dfn-eventtypes"> event handler event types</dfn></a> are defined in
  [[!HTML5]]. 
</section>

<!------------------------ Security and privacy ------------------------------>
<section id="security">
      <h2>Security and privacy considerations</h2>
      <p>This API MUST be only exposed to trusted content</p>

<p class="note">Needs to be flushed out. Tina & Vadim discussing a proposal to address this. </p>

</section>

<!---------------------- Extended interface Navigator ------------------------>
<section>
  <h3><a>Navigator</a> Interface</h3>
    <dl title="partial interface Navigator" class="idl">
      <dt>readonly attribute Vehicle vehicle</dt>
      <dd>The object that exposes the interface to vehicle information services.</dd>
  </dl>
</section>
    
<!------------------------ Interface Vehicle ------------------------------->
<section>
  <h3><a>Vehicle</a> Interface</h3> <p>The <a>Vehicle</a> interface
  represents the initial entry point for getting access to the vehicle information
  services, i.e. Engine Speed and Tire Pressure. </p>
  <p class="note">No data types here should be nullable and we need to add an attribute that returns a map or what the system capabilities are
  what is supported or not supported and why and a method to subscribe to capability changes</p>
  <dl title="[NoInterfaceObject] interface Vehicle" class="idl">  
  </dl>
</section>

<!------------------------ Interface Zone ------------------------>
<section>
  <h3><a>Zone</a> Interface</h3> <p>The <a>Zone</a>
  interface contains the constants that represent physical zones and logical zones</p>
  
  <dl title="[NoInterfaceObject] interface Zone"
  class="idl">
    <dt>const DOMString Front = "Front"</dt>
    <dt>const DOMString Middle = "Middle"</dt>
    <dt>const DOMString Right = "Right"</dt>
    <dt>const DOMString Left = "Left"</dt>
    <dt>const DOMString Rear = "Rear"</dt>
    <dt>const DOMString Center = "Center"</dt>

    <dt>attribute DOMString[] value</dt><dd>MUST return array of physical zones</dd>
    <dt>readonly attribute Zone driver</dt><dd>MUST return physical zone for logical driver</dd>
    <dt>readonly attribute Zone passenger</dt><dd>MUST return physical zone for logical passenger</dd>
    
    <dt>boolean equals(Zone zone)</dt><dd>MUST return true if zone.value matches the contents of this.value.  
    Ordering of elements within Zone.value does not matter.</dd>
    
    <dt>boolean contains(Zone zone)</dt><dd>MUST return true if zone.value can be found within this.value</dd>
    
  </dl>
</section>

<!------------------------ Callback VehicleInterfaceCallback------------------------------>
<section>
  <h3><a>VehicleInterfaceCallback</a> Callback</h3>
  <p>The <a>VehicleInterfaceCallback</a> </p>
  <dl title="callback VehicleInterfaceCallback = void(object value);" class="idl"></dl>
</section> 

<!------------------------ Callback VehicleInterfaceErrorCallback------------------------------>
<section>
  <h3><a>VehicleInterfaceErrorCallback</a> Callback</h3>
  <p>The <a>VehicleInterfaceErrorCallback</a> </p>
  <p class="note">Define the types of possible errors</p>
  <dl title="callback VehicleInterfaceErrorCallback = void(VehicleInterfaceError error);" class="idl"></dl>
</section> 

<!------------------------ Callback AvailableCallback------------------------------>
<section>
  <h3><a>AvailableCallback</a> Callback</h3>
  <p>The <a>AvailableCallback</a> </p>
  <dl title="callback AvailableCallback = void (Availability available)" class="idl"></dl>
</section> 

<!------------------------ Interface VehicleInterfaceError ------------------------>

<section>
   <h3><a>VehicleInterfaceError</a> Interface</h3>
   <p>VehicleInterfaceError is used to identify the type of error encountered during an opertion</p>
   
   <dl title="enum VehicleError" class="idl">
     <dt>permission_denied</dt>
     <dd>Indicates that the user does not have permission to perform the operation</dd>
     <dt>invalid_operation</dt>
     <dd>Indicates that the operation is not valid.  This can be because it isn't supported or has invalid arguments</dd>
     <dt>timeout</dt>
     <dd>Operation timed out.  Timeout length depends upon the implementation</dd>
     <dt>invalid_zone</dt>
     <dd>Indicates the zone argument is not valid</dd>
     <dt>unknown</dt>
     <dd>Indicates an error that is not known</dd>
   </dl>
   
   <dl title="[NoInterfaceObject] interface VehicleInterfaceError"
  class="idl">
     <dt>readonly attribute VehicleError error</dt>
     <dd>MUST return VehicleError</dd>
     <dt>readonly attribute DOMString message</dt>
     <dd>MUST return user-readable error message</dd>
  </dl>
</section>

<!------------------------ Interface VehicleInterface ------------------------>
<section>
  <h3><a>VehicleInterface</a> Interface</h3> <p>The <a>VehicleInterface</a>
  interface represents the base interface to get and set all vehicle properties.</p>
  
  <dl title="[NoInterfaceObject] interface VehicleInterface"
  class="idl">

    <dt>Promise get(optional Zone zone)</dt>
    <dd>MUST return the Promise.  The "resolve" callback in the promise is used to pass the vehicle data type that corresponds to the specific VehicleInterface instance.  For example, "vehicle.vehicleSpeed" corresponds to the "VehicleSpeed" data type.</dd>
    <dt>Promise set(object value, optional Zone zone)</dt>
    <dd>MUST return Promise.  The "resolve" callback indicates the set was successful.  No data is passed to resolve.  If there was an error, "reject" will be called with a VehicleInterfaceError object</dd>
    <dt>unsigned short subscribe(VehicleInterfaceCallback callback, optional Zone zone)</dt>
    <dd>MUST return handle to subscription or 0 if error</dd>
    <dt>void unsubscribe(unsigned short handle)</dt>
    <dd>MUST return void.  unsubscribes to value changes on this interface.</dd>
    <dt>readonly attribute Zone[] zones</dt>
    <dd>MUST return all zones supported for this type.</dd>
  </dl>
  
  <pre class="example highlight">
  vehicle.vehicleSpeed.get().then(resolve);
  
  function resolve(data)
  {
    //data is of type VehicleSpeed
    console.log("Speed: " + data.speed);
    console.log("Time Stamp: " + data.timestamp);
  }
  </pre>
  
  <pre class="example highlight">
  var zone = Zone
  vehicle.door.set({"lock" : true}, zone.driver).then(resolve, reject);
  
  function resolve()
  {
    /// success
  }
  
  function reject(errorData)
  {
    console.log("Error occurred during set: " + errorData.message + " code: " + errorData.error);
  }
  </pre>
  
</section>

<section>
  <h2>Data availability</h2>
  <p>The availability API allows for developers to determine what attributes are available or not and if not, why.  It also allows for notifications when the availability
   changes.</p>
   
  <dl title="enum Availability"
  class="idl">
    <dt>available</dt>
    <dd>data is available</dd>
    <dt>not_supported</dt>
    <dd>not supported by this vehicle</dd>
    <dt>not_supported_yet</dt>
    <dd>not supported at this time, but may become supported later.</dd>
    <dt>not_supported_security</dt>
    <dd>not supported because of security</dd>
    <dt>not_supported_policy</dt>
    <dd>not supported because of system policy</dd>
    <dt>not_supported_other</dt>
    <dd>not supported for other reasons</dd>
  </dl>
   
   <dl title="partial interface VehicleInterface" class="idl">
     <dt>Availability available()</dt>
     <dd>MUST return whether a not this attribute is available or not</dd>
     <dt>readonly attribute boolean supported</dt>
     <dd>MUST return true if this attribute is supported and available</dd>
     <dt>short availabilityChangedListener( AvailableCallback callback )</dt>
     <dd>MUST return handle for listener.</dd>
     <dt>void removeAvailabilityChangedListener( short handle )</dt>
   </dl>
   
   <pre class="example highlight">
   if( ( var a = vehicle.vehicleSpeed.available() ) === "available" )
   {
     // we can use it.
   }
   else
   {
     // tell us why:
     console.log(a);
   }
   </pre>
   <pre class="example highlight">
   var canHasVehicleSpeed = vehicle.vehicleSpeed.available() === "available";

   vehicle.vehicle.availabilityChangedListener( function (available) {
     canHasVehicleSpeed = available === "available";
     checkVehicleSpeed();
   });

   function checkVehicleSpeed()
   {
     if(canHasVehicleSpeed)
     {
       vehicle.vehicleSpeed.get().then(callback);
     }        
   }
  </pre>
  
</section>

<!------------------------ Interface VehicleCommonDataType ------------------------>
<section>
  <h3><a>VehicleCommonDataType</a> Interface</h3> <p>The <a>VehicleCommonDataType</a>
  interface represents the common data type for all vehicle data types</p>
  
  <dl title="[NoInterfaceObject] interface VehicleCommonDataType"
  class="idl">
    <dt>readonly attribute Zone? zone</dt><dd>MUST return zone for this data type or null if there is no zone associated with this data type</dd>
    <dt>readonly attribute DOMTimeStamp? timeStamp</dt><dd>MUST return timestamp when this data was received on the system</dd>
  </dl>
</section>
<section class="use-cases">
  <h2>Use-Cases</h2>
  
<section>
      	<h3>Normative</h3>
        The primary purpose of this specification is to provide web developers the ability to access and set vehicle
        information through a simple common set of operations including get, set, subscribe, and unsubscribe.  Thus
        normative use cases pertain to this access and do not cover higher application of business level use cases.
        <section>
            <h4>Get </h4>
            Get a single value once from the vehicle.
        </section>
        <section>
            <h4>Set </h4>
            Set a single value once in the vehicle.
        </section>
        <section>
            <h4>Subscribe </h4>
            Subscribe to single value until unsubscribed.
        </section>
        <section>
            <h4>Set </h4>
            Unsubscribe to single value.
        </section>
  	</section>
</section>
  </body>
</html>

